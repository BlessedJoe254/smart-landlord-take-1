<!DOCTYPE html>
<html>
<head>
  <title>Book House</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: green;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: darkgreen;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Book This House</h2>
  <p><strong>Pay via Till Number:</strong> 4261592 - Joe Mutugi</p>
  
  <p id="houseDetails"></p>
  
  <label>Payment Type:</label>
  <select id="paymentType">
    <option value="Rent">Rent</option>
    <option value="Deposit">Deposit</option>
    <option value="Rent+Deposit">Rent + Deposit</option>
  </select>

  <label>Amount Paid (KES):</label>
  <input type="number" id="amountPaid" placeholder="Enter amount" required>

  <label>Mpesa Code:</label>
  <input type="text" id="mpesaCode" placeholder="Enter Mpesa code" required>

  <button onclick="submitBooking()">Submit Booking</button>
</div>

<script>
  // Get house index from URL
  const urlParams = new URLSearchParams(window.location.search);
  const houseIndex = urlParams.get("index");

  let houses = JSON.parse(localStorage.getItem("houses")) || [];
  const house = houses[houseIndex];

  if (house) {
    document.getElementById("houseDetails").innerHTML = 
      `<strong>Location:</strong> ${house.location} <br>
       <strong>Type:</strong> ${house.type} <br>
       <strong>Price:</strong> KES ${house.price} <br>
       <strong>Status:</strong> ${house.status}`;
  }

  function submitBooking() {
    const paymentType = document.getElementById("paymentType").value;
    const amountPaid = document.getElementById("amountPaid").value;
    const mpesaCode = document.getElementById("mpesaCode").value;

    if (!amountPaid || !mpesaCode) {
      alert("Please fill all fields");
      return;
    }

    // Save booking for landlord
    let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    bookings.push({
      house: house,
      paymentType,
      amountPaid,
      mpesaCode,
      date: new Date().toLocaleString()
    });
    localStorage.setItem("bookings", JSON.stringify(bookings));

    // Mark house as booked
    houses[houseIndex].status = "Booked";
    localStorage.setItem("houses", JSON.stringify(houses));

    alert("Booking submitted successfully!");
    window.location.href = "houses.html";
  }
</script>

</body>
</html>
